<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example: dipole moments vs E · BialkaliSpectrum.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">BialkaliSpectrum.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Guide</span><ul><li><a class="tocitem" href="../basics/">Getting started</a></li><li class="is-active"><a class="tocitem" href>Example: dipole moments vs E</a><ul class="internal"><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Plotting-the-induced-dipoles"><span>Plotting the induced dipoles</span></a></li><li><a class="tocitem" href="#Plotting-transition-dipoles"><span>Plotting transition dipoles</span></a></li><li><a class="tocitem" href="#Dumping-the-outputs-to-a-file"><span>Dumping the outputs to a file</span></a></li><li><a class="tocitem" href="#Custom-plotting-with-CairoMakie.jl"><span>Custom plotting with CairoMakie.jl</span></a></li><li><a class="tocitem" href="#Plotting-shortcuts"><span>Plotting shortcuts</span></a></li></ul></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../api/setting_up/">Setting up a calculation</a></li><li><a class="tocitem" href="../../api/analyzing_spectrum/">Analyzing the results</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Guide</a></li><li class="is-active"><a href>Example: dipole moments vs E</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example: dipole moments vs E</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/kylematsuda/BialkaliSpectrum.jl/blob/master/docs/src/man/worked_example.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Example:-dipole-moments-vs-E"><a class="docs-heading-anchor" href="#Example:-dipole-moments-vs-E">Example: dipole moments vs E</a><a id="Example:-dipole-moments-vs-E-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-dipole-moments-vs-E" title="Permalink"></a></h1><ul><li><a href="#Example:-dipole-moments-vs-E">Example: dipole moments vs E</a></li><li class="no-marker"><ul><li><a href="#Setup">Setup</a></li><li><a href="#Plotting-the-induced-dipoles">Plotting the induced dipoles</a></li><li><a href="#Plotting-transition-dipoles">Plotting transition dipoles</a></li><li><a href="#Dumping-the-outputs-to-a-file">Dumping the outputs to a file</a></li><li><a href="#Custom-plotting-with-CairoMakie.jl">Custom plotting with CairoMakie.jl</a></li><li><a href="#Plotting-shortcuts">Plotting shortcuts</a></li></ul></li></ul><p>This is a more complete worked example using <code>BialkaliSpectrum</code>.</p><p>Let&#39;s compute various dipole moments as a function of electric field!</p><p>For simplicity, we&#39;ll do the calculation without including hyperfine structure. <code>BialkaliSpectrum</code> has a module <code>BialkaliSpectrum.Toy</code> that defines molecular parameters for an idealized molecule without hyperfine structure.</p><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><p>We&#39;ll start by setting up a scan of the electric field:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; parts = make_toy_hamiltonian_parts(8);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; fields = generate_fields_scan(0.0, 0.0:0.2:4.0, [[]]);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; spectra = get_spectra(parts, fields, df -&gt; filter_rotational(df, [0, 1, 2]))</code><code class="nohighlight hljs ansi" style="display:block;">Progress:  10%|███▉                                     |  ETA: 0:00:01Progress: 100%|█████████████████████████████████████████| Time: 0:00:00
189×13 DataFrame
 Row │ fields                             index  energy             eigenstate ⋯
     │ External…                          Int64  Complex…           SubArray…  ⋯
─────┼──────────────────────────────────────────────────────────────────────────
   1 │ ExternalFields(SphericalVector(0…      1          0.0+0.0im  ComplexF64 ⋯
   2 │ ExternalFields(SphericalVector(0…      2          2.0+0.0im  ComplexF64
   3 │ ExternalFields(SphericalVector(0…      3          2.0+0.0im  ComplexF64
   4 │ ExternalFields(SphericalVector(0…      4          2.0+0.0im  ComplexF64
   5 │ ExternalFields(SphericalVector(0…      5          6.0+0.0im  ComplexF64 ⋯
   6 │ ExternalFields(SphericalVector(0…      6          6.0+0.0im  ComplexF64
   7 │ ExternalFields(SphericalVector(0…      7          6.0+0.0im  ComplexF64
   8 │ ExternalFields(SphericalVector(0…      8          6.0+0.0im  ComplexF64
  ⋮  │                 ⋮                    ⋮            ⋮                     ⋱
 183 │ ExternalFields(SphericalVector(0…      3      1.26985+0.0im  ComplexF64 ⋯
 184 │ ExternalFields(SphericalVector(0…      4      2.60238+0.0im  ComplexF64
 185 │ ExternalFields(SphericalVector(0…      5      5.62877+0.0im  ComplexF64
 186 │ ExternalFields(SphericalVector(0…      6      5.62877+0.0im  ComplexF64
 187 │ ExternalFields(SphericalVector(0…      7      6.12299+0.0im  ComplexF64 ⋯
 188 │ ExternalFields(SphericalVector(0…      8      6.12299+0.0im  ComplexF64
 189 │ ExternalFields(SphericalVector(0…      9      6.41283+0.0im  ComplexF64
                                                 10 columns and 174 rows omitted</code></pre><p>This gives us the eigenstates and energies as a function of field.</p><p>For the toy molecule, the molecular parameters are such that the characteristic field is <span>$E_c = B / d = 1 \text{ V/cm}$</span>. This is a bit of a weird situation, so let&#39;s try to make this somewhat  more clear by adding a new column <code>:ϵ</code> to the <code>DataFrame</code>, representing the unitless E-field parameter <span>$\epsilon = E/E_c$</span>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; DataFrames.transform!(spectra, :E =&gt; DataFrames.ByRow(identity) =&gt; :ϵ);</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>We&#39;ll also want to use <a href="../../api/analyzing_spectrum/#BialkaliSpectrum.adiabatic-Tuple{Any}"><code>adiabatic</code></a> here. This method adds a new column, <code>:adiabatic_index</code>. To obtain the values of these columns, the function first groups the <code>DataFrame</code> by <code>:fields</code> and  indexes the state in the first group in order of increasing energy; the value of <code>:adiabatic_index</code> is assigned to these index. The function next steps through the remaining groups, at each point giving each  eigenstate&#39;s <code>:adiabatic_index</code> to match the value of the eigenstate in the previous group with which it has the best overlap.</p><p>In other words, <a href="../../api/analyzing_spectrum/#BialkaliSpectrum.adiabatic-Tuple{Any}"><code>adiabatic</code></a> connects states for us across different fields based on the criterion of wavefunction adiabaticity as the field is changed. This lets us track states through avoided crossings, and distinguishes between real crossings and avoided ones.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; spectra = adiabatic(spectra);</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><h2 id="Plotting-the-induced-dipoles"><a class="docs-heading-anchor" href="#Plotting-the-induced-dipoles">Plotting the induced dipoles</a><a id="Plotting-the-induced-dipoles-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-the-induced-dipoles" title="Permalink"></a></h2><p>Having done this, let&#39;s now use <a href="../../api/analyzing_spectrum/#BialkaliSpectrum.induced_dipole_moments-Tuple{Any, HamiltonianParts}"><code>induced_dipole_moments</code></a> to compute the dipole moments, which are added in a column called <code>:d_ind</code>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; dips = induced_dipole_moments(spectra, parts);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; dips.d_ind</code><code class="nohighlight hljs ansi" style="display:block;">189-element Vector{Float64}:
  0.0
  0.0
  0.0
  0.0
  0.0
  0.0
  0.0
  0.0
  0.0
  0.06634336919484445
  ⋮
  0.6396895268698228
  0.3366301572865634
  0.336630157286555
 -0.08170649109318481
  0.1810544753538695
  0.1810544753538617
 -0.03449692098212524
 -0.034496920982123314
 -0.21103745456292206</code></pre><p>We can now easily plot the dipole moments with <a href="../../api/analyzing_spectrum/#BialkaliSpectrum.plot_induced_dipole-Tuple{Any, HamiltonianParts}"><code>plot_induced_dipole</code></a>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; plot_induced_dipole(dips; groupby=:ϵ);</code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p><img src="../induced_dipoles.svg" alt/></p><div class="admonition is-info"><header class="admonition-header">Keyword arguments to the plotting function</header><div class="admonition-body"><p>A bit of explanation:</p><ul><li>The <code>groupby</code> keyword argument sets the x-axis of the plot, and defaults to <code>:E</code>. In this case, we override the default since we want to plot against <code>:ϵ</code> instead.</li><li>The <code>use_adiabatic</code> kwarg sets how states are connected in the line plot across different fields. The default is <code>use_adiabatic=true</code>, which uses <code>:adiabatic_index</code> to connect the states. If <code>use_adiabatic=false</code>, then <code>:index</code> (counts energies at a given field from lowest to highest) is used instead.</li></ul></div></div><h2 id="Plotting-transition-dipoles"><a class="docs-heading-anchor" href="#Plotting-transition-dipoles">Plotting transition dipoles</a><a id="Plotting-transition-dipoles-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-transition-dipoles" title="Permalink"></a></h2><p>Let&#39;s next plot the dipole matrix elements between different states. To do this, we&#39;ll call <a href="../../api/analyzing_spectrum/#BialkaliSpectrum.transitions"><code>transitions</code></a>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; ts = transitions(spectra, parts, State(0, 0); restrict_N=false, cutoff=nothing);</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>The third argument, <code>State(0, 0)</code>, sets the &quot;ground state&quot; for this calculation. The dipole moments between this state and each other state are computed and  stored in the columns <code>:d_0</code>, <code>:d_plus</code>, and <code>:d_minus</code>.</p><p>Note that we also override some of the default keyword args. The defaults have a nice behavior for some other calculations, but aren&#39;t the best here. See the docs for <a href="../../api/analyzing_spectrum/#BialkaliSpectrum.transitions"><code>transitions</code></a> for more info.</p><p>We can plot these up. Here are the <span>$d^0$</span> matrix elements:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; plot_transition_dipole(ts, State(0, 0), 0; groupby=:ϵ);</code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p><img src="../transition_dipoles_0.svg" alt/></p><p>The third argument sets which spherical tensor component of the dipole operator is plotted. We can plot the <span>$d^{+1}$</span> matrix elements instead:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; plot_transition_dipole(ts, State(0, 0), 1; groupby=:ϵ);</code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p><img src="../transition_dipoles_1.svg" alt/></p><h2 id="Dumping-the-outputs-to-a-file"><a class="docs-heading-anchor" href="#Dumping-the-outputs-to-a-file">Dumping the outputs to a file</a><a id="Dumping-the-outputs-to-a-file-1"></a><a class="docs-heading-anchor-permalink" href="#Dumping-the-outputs-to-a-file" title="Permalink"></a></h2><p>For later use, we often want to output the results to a file. In this example, we&#39;ll put induced dipole moments of <span>$|0,0\rangle$</span> and <span>$|1,0\rangle$</span> and the transition dipole moment between them into a CSV file.</p><p>We&#39;ve already calculated all the necessary dipole moments, but the <code>DataFrame</code>  also has a bunch of extra information. We can remind ourselves by running the following command:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; names(ts)</code><code class="nohighlight hljs ansi" style="display:block;">21-element Vector{String}:
 &quot;fields&quot;
 &quot;index&quot;
 &quot;energy&quot;
 &quot;eigenstate&quot;
 &quot;basis_index&quot;
 &quot;N&quot;
 &quot;m_n&quot;
 &quot;I_1&quot;
 &quot;m_i1&quot;
 &quot;I_2&quot;
 ⋮
 &quot;E&quot;
 &quot;ϵ&quot;
 &quot;adiabatic_index&quot;
 &quot;ground_state&quot;
 &quot;transition_frequency&quot;
 &quot;d_minus&quot;
 &quot;d_0&quot;
 &quot;d_plus&quot;
 &quot;transition_strength&quot;</code></pre><p>Let&#39;s <code>select</code> what we want into a new <code>DataFrame</code>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; n_0_and_1 = filter_rotational(dips, [0, 1], 0);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; d_inds = DataFrames.select(n_0_and_1, [:ϵ, :N, :m_n, :d_ind])</code><code class="nohighlight hljs ansi" style="display:block;">42×4 DataFrame
 Row │ ϵ        N      m_n    d_ind
     │ Float64  Int64  Int64  Float64
─────┼───────────────────────────────────
   1 │     0.0      0      0   0.0
   2 │     0.0      1      0   0.0
   3 │     0.2      0      0   0.0663434
   4 │     0.2      1      0  -0.0396689
   5 │     0.4      0      0   0.130808
   6 │     0.4      1      0  -0.0774126
   7 │     0.6      0      0   0.191796
   8 │     0.6      1      0  -0.111589
  ⋮  │    ⋮       ⋮      ⋮        ⋮
  36 │     3.4      1      0  -0.13345
  37 │     3.6      0      0   0.619027
  38 │     3.6      1      0  -0.116809
  39 │     3.8      0      0   0.629787
  40 │     3.8      1      0  -0.0994934
  41 │     4.0      0      0   0.63969
  42 │     4.0      1      0  -0.0817065
                          27 rows omitted</code></pre><p>The data is currently in &quot;long format&quot;, with separate rows for <span>$|0,0\rangle$</span> and <span>$|1,0\rangle$</span> at each field. For this example, let&#39;s put it in &quot;wide format&quot; instead, so we have a single row at each field with the induced dipoles (<code>:d00</code> and <code>:d11</code>) as the columns. For this, we can use the <a href="../../api/analyzing_spectrum/#BialkaliSpectrum.wide_format-Tuple{Any, Any, Function}"><code>wide_format</code></a> function:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; formatted = wide_format(d_inds, :d_ind, row -&gt; &quot;d$(row.N)$(row.N)&quot;; groupby=:ϵ)</code><code class="nohighlight hljs ansi" style="display:block;">21×3 DataFrame
 Row │ d00        d11         ϵ
     │ Float64    Float64     Float64
─────┼────────────────────────────────
   1 │ 0.0         0.0            0.0
   2 │ 0.0663434  -0.0396689      0.2
   3 │ 0.130808   -0.0774126      0.4
   4 │ 0.191796   -0.111589       0.6
   5 │ 0.248178   -0.141027       0.8
   6 │ 0.299349   -0.165085       1.0
   7 │ 0.345162   -0.183587       1.2
   8 │ 0.38581    -0.196703       1.4
  ⋮  │     ⋮          ⋮          ⋮
  15 │ 0.56458    -0.17691        2.8
  16 │ 0.580253   -0.16377        3.0
  17 │ 0.594419   -0.149189       3.2
  18 │ 0.607286   -0.13345        3.4
  19 │ 0.619027   -0.116809       3.6
  20 │ 0.629787   -0.0994934      3.8
  21 │ 0.63969    -0.0817065      4.0
                        6 rows omitted</code></pre><p>To get the transition dipole, we can filter our original <code>DataFrame</code> and join it with <code>formatted</code>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; d_transition = DataFrames.select(filter_rotational(ts, 1, 0), [:ϵ, :d_0]);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; DataFrames.transform!(d_transition, :d_0 =&gt; DataFrames.ByRow(abs) =&gt; :d01);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; DataFrames.select!(d_transition, [:ϵ, :d01]);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; formatted = DataFrames.DataAPI.rightjoin(formatted, d_transition; on=:ϵ)</code><code class="nohighlight hljs ansi" style="display:block;">21×4 DataFrame
 Row │ d00        d11         ϵ        d01
     │ Float64?   Float64?    Float64  Float64
─────┼──────────────────────────────────────────
   1 │ 0.0         0.0            0.0  0.57735
   2 │ 0.0663434  -0.0396689      0.2  0.574616
   3 │ 0.130808   -0.0774126      0.4  0.566687
   4 │ 0.191796   -0.111589       0.6  0.554321
   5 │ 0.248178   -0.141027       0.8  0.538572
   6 │ 0.299349   -0.165085       1.0  0.520586
   7 │ 0.345162   -0.183587       1.2  0.501419
   8 │ 0.38581    -0.196703       1.4  0.481944
  ⋮  │     ⋮          ⋮          ⋮        ⋮
  15 │ 0.56458    -0.17691        2.8  0.369837
  16 │ 0.580253   -0.16377        3.0  0.358354
  17 │ 0.594419   -0.149189       3.2  0.347852
  18 │ 0.607286   -0.13345        3.4  0.338241
  19 │ 0.619027   -0.116809       3.6  0.32943
  20 │ 0.629787   -0.0994934      3.8  0.321336
  21 │ 0.63969    -0.0817065      4.0  0.313879
                                  6 rows omitted</code></pre><p>Now that we have it in the right format, we can easily <a href="https://dataframes.juliadata.org/stable/man/importing_and_exporting/">save it to a CSV</a>.</p><h2 id="Custom-plotting-with-CairoMakie.jl"><a class="docs-heading-anchor" href="#Custom-plotting-with-CairoMakie.jl">Custom plotting with CairoMakie.jl</a><a id="Custom-plotting-with-CairoMakie.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-plotting-with-CairoMakie.jl" title="Permalink"></a></h2><p>Plan: Put a custom plot here using the contents of <code>formatted</code>.</p><h2 id="Plotting-shortcuts"><a class="docs-heading-anchor" href="#Plotting-shortcuts">Plotting shortcuts</a><a id="Plotting-shortcuts-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-shortcuts" title="Permalink"></a></h2><p>Plan: Show examples of the other signatures of the above plotting methods (the ones that take <code>hamiltonian_parts</code>).</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../basics/">« Getting started</a><a class="docs-footer-nextpage" href="../../api/setting_up/">Setting up a calculation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.16 on <span class="colophon-date" title="Friday 22 April 2022 20:20">Friday 22 April 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
